<html>
    <head>
        <link rel="stylesheet"  media="screen" href="atelier.css">
        <script src="https://cdn.babylonjs.com/babylon.js"></script>
    </head>
    <body>
        <div class="button-group">
          <button onclick="jukebox(0)">Megalovania</button>
          <button onclick="jukebox(1)">Deja vu</button>
          <button onclick="jukebox(2)">My Time is now</button>
          <button onclick="jukebox(3)">Guile Theme</button>
          <button onclick="jukebox(4)">We are number one</button>
          <button onclick="jukebox(5)">Nyan Cat</button>
          <button onclick="jukebox(6)">Every time we touch</button>
          <button onclick="jukebox(7)">Tetris theme</button>
        </div>
        
        <div class="square"></div>
        <canvas id="main"></canvas>
    </body>
</html>

<script>
const ctx = new AudioContext()

const frequency3 = {
    c: 130,
    C: 138,
    d: 146,
    D: 155,
    e: 164,
    f: 174,
    F: 185,
    g: 196,
    G: 208,
    a: 220,
    A: 233,
    b: 246 
  }

const frequency4 = {
    c: 261,
    C: 277,
    d: 293,
    D: 311,
    e: 329,
    f: 349,
    F: 369,
    g: 392,
    G: 415,
    a: 440,
    A: 466,
    b: 493 
  }

  const frequency5 = {
    c: 523,
    C: 554,
    d: 587,
    D: 622,
    e: 659,
    f: 698,
    F: 739,
    g: 784,
    G: 830,
    a: 880,
    A: 932,
    b: 987 
  }

  const frequency6 = {
    c: 1047,
    C: 1109,
    d: 1175,
    D: 1245,
    e: 1319,
    f: 1397,
    F: 1480,
    g: 1568,
    G: 1661,
    a: 1760,
    A: 1865,
    b: 1976
  }

function playNote(note, tab) {
  const frequency = tab[note];
  if (frequency === undefined) return new Promise(res => setTimeout(res, 80))
  const osc = ctx.createOscillator();
  osc.connect(ctx.destination);
  osc.frequency.value = frequency;
  osc.type = "triangle"
  osc.start();
  return new Promise(res => {
    setTimeout(() => {
      osc.stop();
      res(osc.disconnect());
    }, 80)
  })
}

async function playMusic (notesArray) {

  for(let elem of notesArray) {
    elem.notes = elem.notes.split('')
  }
  for (let i = 0; i < notesArray[0].notes.length; ++i) {
    let promisesArray = []
    for(const elem of notesArray) {
      promisesArray.push(playNote(elem.notes[i], elem.octave))
    }
    await Promise.all(promisesArray);
  }
}
const megalovania5 = '--d---------------d---------------d---------------d---------------d---------------d---------------d---------------d---------------'
const megalovania4 = 'dd--a--G-g-f-dfgcc--a--G-g-f-dfg----a--G-g-f-dfg----a--G-g-f-dfgdd--a--G-g-f-dfgcc--a--G-g-f-dfg----a--G-g-f-dfg----a--G-g-f-dfgdd'
const megalovania3 = '--------------------------------bb--------------AA----------------------------------------------bb--------------AA----------------'

const dejavu5 = '--------------------------------------------------------------------------D-D-f-d---d---c-D---------------D-D-f-D-f-f---g-g-f-------g-----------------------------------------------------------------------------------------------------'
const dejavu4 = 'c-d-D-----D-D-d-c-------c-c---g-f-D-d-D---D-D-f-D-f-f---g-g-f---c-d-D-------------A-----------g-f-D-d-D-----------------------------------------D-d-D-----D-D-d---------c-c---g-f-D-d-D---D-D-f-D-f-f---g-g-f---c-d-D-------------A-------'
const dejavu3 = '--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------A-g-A-----------------'

const johncena5 = '----------------------------------------------------------------------------------------------------------------------------------'
const johncena4 = 'g-af-g----------A-af-g----------g-af-g----------A-af-g----------g-af-g----------A-af-g----------g-af-g----------A-af-g------------'
const johncena3 = '----------------------------------------------------------------------------------------------------------------------------------'

const sfGuile5 = 'D-Dd-dD-------d-D-Dd-dD-------d-Dd-D-d-f-fD-d---D-Dd-dD-------d-D-Dd-dD-------d-Dd-D-d-f-fD-d-------------------------------------------------------------------------------------------------------------c-dD--g---f---d-------c---------d-D-f-c---------d-Df--g-------------------------------c---------g-fg--f---D---d-------c-------------------------------c---------d-Df-g---G--f---d-cd--d---D--f------f-G-----gfg---f-D-c---------d-D-f-f---------g-Dd--d-Dc----------------------------c---------d-Df-g----c--A--G-g-f-dD-c----'
const sfGuile4 = 'D-Dd-dD-------d-D-Dd-dD-------d-Dd-D-d-f-fD-d-A-D-Dd-dD-------d-D-Dd-dD-------d-Dd-D-d-f-fD-d-A-c---------d-Df--g--gf-A---G-gG--d---D--f----d-f-G---A--g--g-fd--c---------d-Df--g--gG-f---f-gG--A---------------g---f---d---A---c---------d-D-f-c---------d-Df--g---------------------------A-A-G---------g-fg--f---D---d---A---c---g-----------------------A-A-c---------d-Df-g---G--f---d-cd--d---D--f--A---f-G-----gfg---f-D-c---------d-D-f-f---------g-Dd--d-Dc------------------------A-A-c---------d-Df-g----c--A--G-g-f-dD-c----'
const sfGuile3 = '----------------------------------------------A---------------------------------------------------A---------------------------------------A---------------------------------------------------------------------------------A-----------------------------------------------------------------------------------------------A-------g-----------------------A-A-------------------------------------------A---------------------------------------------------------------------------------A-A-----------------------------------------'

const wearenumberone5 = '------c--c-c--c---------------c-C-------C---D---c-C-c-C-c---------------------'
const wearenumberone4 = 'f-------b-b-b---G---f-----f-G-------G-----------------------------------------'
const wearenumberone3 = '------------------------------------------------------------------------------'

const nyanCat5 = '----------CDC-----------C--CeDeCF-G-DD--dC----C-d-dC-CDFGDFCD-C-D-F-GDFCD-dDdC-Cd--CDFCDC-C---C-F-G-DD--dC----C-d-dC-CDFGDFCD-C-D-F-GDFCD-dDdC-Cd--CDFCDC-C---C----------CD-eDeF--------eDC---------------CD------------eDeF-------------CD-eDeF--------eDC---------------CD------------eDeF--C-------------------------'
const nyanCat4 = 'DeF-b-DeFb---Ab-F-DeF-b--Ab------------b--b-b-------b--------b-b---------b----b---b------b--b----------b--b-b-------b--------b-b---------b----b---b------b--b---b-FGb-FGb--b----b-b-FGbF---bFDeFb-FGb-FGbb--bFGFb-bAbFGb----b-G-b-FGb-FGb--b----b-b-FGbF---bFDeFb-FGb-FGbb--bFGFb-bAbFGb----b---------------------------'
const nyanCat3 = '------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------'

async function jukebox (choice) {
  switch (choice) {
      case 0: await playMusic([
        {
          notes: megalovania5,
          octave: frequency5
        },
        {
          notes: megalovania4,
          octave: frequency4
        },
        {
          notes: megalovania3,
          octave: frequency3
        }
      ]); break
      case 1: await playMusic([
        {
          notes: dejavu5,
          octave: frequency5
        },
        {
          notes: dejavu4,
          octave: frequency4
        },
        {
          notes: dejavu3,
          octave: frequency3
        }
      ]); break
      case 2: await playMusic([
        {
          notes: johncena5,
          octave: frequency5
        },
        {
          notes: johncena4,
          octave: frequency4
        },
        {
          notes: johncena5,
          octave: frequency3
        }
      ]); break
      case 3: await playMusic([
        {
          notes: sfGuile5,
          octave: frequency5
        },
        {
          notes: sfGuile4,
          octave: frequency4
        },
        {
          notes: sfGuile3,
          octave: frequency3
        }
      ]); break
      case 4: await playMusic([
        {
          notes: wearenumberone5,
          octave: frequency5
        },
        {
          notes: wearenumberone4,
          octave: frequency4
        },
        {
          notes: wearenumberone3,
          octave: frequency3
        }
      ]); break
      case 5: await playMusic([
        {
          notes: nyanCat5,
          octave: frequency5
        },
        {
          notes: nyanCat4,
          octave: frequency4
        },
        {
          notes: nyanCat3,
          octave: frequency3
        }
      ]); break
      case 6: await playMusic([
        {
          notes: '--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------c-c---c-------------------------------------------------------------------------------------------------------------------------------------------------',
          octave: frequency6
        },
        {
          notes: '--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------c-c-------------------------c---c-c-----------c-C-C-c-----------fff-g-g-G-G---f---D---G---A-G-A----------AG---f---D---C-c-D-----------------------------------------------------------------------------------------------------------------------------',
          octave: frequency5
        },
        {
          notes: '----c-----c-----f---D---------c-----c-----f---D---------c-----c-----f---D-------f---D-----c-----D---D---------------------------g---G-----g-----f-D-D-----C-----c---------D-----C-c-C-c-c-------g---G-----g-----f-D-D-----G-----g---g---g-----------g-----G-G-g-g-f-f-----f-g---f-g-g-G---G-G-g-g-f-f---G-A-A-G-g-f-f-------G-g-g-f-f---G---D-----G-g-f-g-G-G-------G---D-D-D-c-c-D-D-----G-G-g-g-f-f-----f-g---f-g-g-G---G-G-g-g-f-f---G-A-A-G-g-f-f-------G-g-g-f-f---G---D-----G-g-f-g-G-G-------G---D-D-D-c-c-D-D---------A-A-G-G---G---A---A-A-A---------A-A-G-G-----------A-G-G-------G-g-g-f-f---G---D---G---g-f-g-D-G---G--gG---C---D-------------G-G-g-g-f-f---f---g---g-g-g-G---G-G-g-g-f-f---G-A-A-G-g-f-f-----GGG-g-g-f-f---G---D---G---g-f-g-D-G---G--gG---D---D---c-',
          octave: frequency4
        },
        {
          notes: '--------------------------------------------------------------------------------------------------------------------------------D---f-----D-----C---c-------------------------------------------D---f-----D---------------------A---A---A-----------A---------------C-----C-D---D-D-D-f---f-f-D-D-C-C---f-g-g-e-c-----------f-D-D-C-C---C---c-----D-D-D-D-f-f-------D---c-c-c-------------D-f-D-D-C-C-----C-D---D-D-D-f---f-f-D-D-C-C---f-g-g-e-c-----------f-D-D-C-C---C---c-----D-D-D-D-f-f-------D---c-c-c-------------G-G-g-g-f-f---f---g---g-g-g-G---G-G-g-g-f-f---G-A-A-G-g-f-f-----GG----------------------------------------------------c-D-------c-c-------------C-------D-----c-f-c-------------C-------D-----c-f-c-------------C---c-D-G-------D-----c-f---c-D-G-D-c---',
          octave: frequency4
        },
        {
          notes: '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------C---c-----D-----D---D---D-----------D-----D-f-D-D-C---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------D-g-A---f-G-------G-f-G-C-f-G---D-g-A---f-G-------G-f-G-C-f-G---G-------D-g-A---f-G-----G-----------G-',
          octave: frequency4
        },
        {
          notes: 'A-----------------------------------A-----A---------G-----------A-------------------G---------------D---A-----------A-------------------------------------A---------A-----------------G-G-------------------------------------------------------------------------------------------------------------------------G-G---------------------------------------------------------G-G-g-g-------------------------------------------------------------G-G---------------------------------------------------------G-G-g-g-------------------------------------------------------------------------------------------------------------------------------A---------D-D-g-C-f-G---------------------------------------------------------------------------------------------------------',
          octave: frequency3
        },
        {
          notes: '----f---------------G---------------D---------------C---------------f-----------------------------------------------g-------------------------------------------G---g-----------A-G-A---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------',
          octave: frequency3
        }
      ]); break
      case 7: await playMusic([
        {
          notes: 'e-----c-d-edc---------c-e---d-c-------c-d---e---c---------------d---d-f-a---g-f-e---e-c-e---d-c-------c-d---e---c---------------e-----c-d-edc---------c-e---d-c-------c-d---e---c---------------d---d-f-a---g-f-e---e-c-e---d-c-------c-d-----------------------e-------c-------d---------------c-------------------------------e-----------------------------------e---a---',
          octave: frequency5
        },
        {
          notes: '--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------e---c---------------c---------------------------------------------------------------c-------c-------d---------------c---c---e---',
          octave: frequency5
        },
        {
          notes: '----b---------b-a---a-----------b---bb--------------a---a---------------------------------------b---bb--------------a---a-----------b---------b-a---a-----------b---b---------------a---a---------------------------------------b---b---------------a---a-------------------------------b---------------a-------G-------b-------------------------------b-------------------',
          octave: frequency4
        },
        {
          notes: '------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------a-------b-------G-------a-------e-------e-------G---------------a-------b-------G-------a-----------',
          octave: frequency4
        }
      ])
      default: break
  }
}

const canvas = document.getElementById("main");
const engine = new BABYLON.Engine(canvas);
const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(1,0.6,0.6);



const camera = new BABYLON.FreeCamera("camera", new BABYLON.Vector3(0,0,-5),scene);

const light = new BABYLON.PointLight("light", new BABYLON.Vector3(0,0,-10),scene);

const box = new BABYLON.Mesh.CreateBox("box",2,scene);

box.material = new BABYLON.StandardMaterial("material",scene);

box.material.diffuseTexture = new BABYLON.Texture('https://images-eu.ssl-images-amazon.com/images/I/41cIIyEzvfL._SL500_AC_SS350_.jpg', scene);

let cpt = 0
engine.runRenderLoop(() => {
  box.rotation.x += Math.random() % 0.02 - 0.01;
  box.rotation.y += Math.random() % 0.02 - 0.01;
  box.material.emissiveColor = new BABYLON.Color3(Math.log(Math.random()), Math.log(Math.random()), Math.log(Math.random()));
  cpt++
  scene.render();
});

</script>
